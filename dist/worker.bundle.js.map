{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./src/message.ts","webpack:///./src/worker.ts"],"names":[],"mappings":"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","file":"worker.bundle.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"/dist/\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = \"./src/worker.ts\");\n","/* Copyright 2018 Mozilla Foundation\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n */\n\nexport enum WorkerCommand {\n  OptimizeWasmWithBinaryen,\n  ValidateWasmWithBinaryen,\n  CreateWasmCallGraphWithBinaryen,\n  ConvertWasmToAsmWithBinaryen,\n  DisassembleWasmWithBinaryen,\n  AssembleWatWithBinaryen,\n  DisassembleWasmWithWabt,\n  AssembleWatWithWabt,\n  TwiggyWasm\n}\n\n/**\n * Worker requests.\n */\nexport interface IWorkerRequest {\n  id: number;\n  payload: ArrayBuffer | string;\n  command: WorkerCommand;\n}\n\n/**\n * Worker response.\n */\nexport interface IWorkerResponse {\n  id: number;\n  payload: ArrayBuffer | string | Object;\n  success: boolean;\n}\n","/* Copyright 2018 Mozilla Foundation\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n */\n\nimport { IWorkerRequest, WorkerCommand, IWorkerResponse } from \"./message\";\n\ndeclare var importScripts: Function;\n\nfunction assert(c: any, message?: string) {\n  if (!c) {\n    throw new Error(message);\n  }\n}\n\ndeclare interface BinaryenModule {\n  optimize(): any;\n  validate(): any;\n  emitBinary(): ArrayBuffer;\n  emitText(): string;\n  emitAsmjs(): string;\n  runPasses(passes: string []): any;\n}\n\ndeclare var Binaryen: {\n  readBinary(data: Uint8Array): BinaryenModule;\n  parseText(data: string): BinaryenModule;\n  print(s: string): void;\n  printErr(s: string): void;\n};\n\ndeclare var wabt: {\n  ready: Promise<any>\n  readWasm: Function;\n  parseWat: Function;\n};\n\nasync function loadBinaryen() {\n  if (typeof Binaryen === \"undefined\") {\n    importScripts(\"../lib/binaryen.js\");\n  }\n}\n\nasync function loadWabt() {\n  if (typeof wabt === \"undefined\") {\n    (self as any).global = self; // Wabt installs itself on the global object.\n    importScripts(\"../lib/wabt.js\");\n  }\n}\n\nlet Twiggy: any = null;\ndeclare var wasm_bindgen: any;\n\nasync function loadTwiggy() {\n  if (!Twiggy) {\n    importScripts(\"../lib/twiggy_wasm_api.js\");\n    await wasm_bindgen(\"../lib/twiggy_wasm_api_bg.wasm\");\n    Twiggy = {\n      Items: wasm_bindgen.Items,\n      Top: wasm_bindgen.Top,\n      Paths: wasm_bindgen.Paths,\n      Monos: wasm_bindgen.Monos,\n      Dominators: wasm_bindgen.Dominators\n    };\n  }\n}\n\nonmessage = (e: {data: IWorkerRequest}) => {\n  const fn = {\n    [WorkerCommand.OptimizeWasmWithBinaryen]: optimizeWasmWithBinaryen,\n    [WorkerCommand.ValidateWasmWithBinaryen]: validateWasmWithBinaryen,\n    [WorkerCommand.CreateWasmCallGraphWithBinaryen]: createWasmCallGraphWithBinaryen,\n    [WorkerCommand.ConvertWasmToAsmWithBinaryen]: convertWasmToAsmWithBinaryen,\n    [WorkerCommand.DisassembleWasmWithBinaryen]: disassembleWasmWithBinaryen,\n    [WorkerCommand.AssembleWatWithBinaryen]: assembleWatWithBinaryen,\n    [WorkerCommand.DisassembleWasmWithWabt]: disassembleWasmWithWabt,\n    [WorkerCommand.AssembleWatWithWabt]: assembleWatWithWabt,\n    [WorkerCommand.TwiggyWasm]: twiggyWasm\n  }[e.data.command];\n  assert(fn, `Command ${e.data.command} not found.`);\n  processMessage(e.data, fn);\n};\n\nasync function processMessage(request: IWorkerRequest, fn: Function) {\n  const response: IWorkerResponse = {\n    id: request.id,\n    payload: null,\n    success: true\n  };\n  try {\n    response.payload = await fn(request.payload);\n  } catch (e) {\n    response.payload = {\n      message: e.message\n    };\n    response.success = false;\n  }\n  postMessage(response, undefined);\n}\n\nasync function optimizeWasmWithBinaryen(data: ArrayBuffer): Promise<ArrayBuffer> {\n  await loadBinaryen();\n  const module = Binaryen.readBinary(new Uint8Array(data));\n  module.optimize();\n  return Promise.resolve(module.emitBinary());\n}\n\nasync function validateWasmWithBinaryen(data: ArrayBuffer): Promise<number> {\n  await loadBinaryen();\n  const module = Binaryen.readBinary(new Uint8Array(data));\n  return Promise.resolve(module.validate());\n}\n\nasync function createWasmCallGraphWithBinaryen(data: ArrayBuffer): Promise<string> {\n  await loadBinaryen();\n  const module = Binaryen.readBinary(new Uint8Array(data));\n  const old = Binaryen.print;\n  let ret = \"\";\n  Binaryen.print = (x: string) => { ret += x + \"\\n\"; };\n  module.runPasses([\"print-call-graph\"]);\n  Binaryen.print = old;\n  return Promise.resolve(ret);\n}\n\nasync function convertWasmToAsmWithBinaryen(data: ArrayBuffer): Promise<string> {\n  await loadBinaryen();\n  const module = Binaryen.readBinary(new Uint8Array(data));\n  module.optimize();\n  return Promise.resolve(module.emitAsmjs());\n}\n\nasync function disassembleWasmWithBinaryen(data: ArrayBuffer): Promise<string> {\n  await loadBinaryen();\n  const module = Binaryen.readBinary(new Uint8Array(data));\n  return Promise.resolve(module.emitText());\n}\n\nasync function assembleWatWithBinaryen(data: string): Promise<ArrayBuffer> {\n  await loadBinaryen();\n  const module = Binaryen.parseText(data);\n  return Promise.resolve(module.emitBinary());\n}\n\nasync function disassembleWasmWithWabt(data: ArrayBuffer): Promise<string> {\n  await loadWabt();\n  const module = wabt.readWasm(data, { readDebugNames: true });\n  module.generateNames();\n  module.applyNames();\n  return Promise.resolve(module.toText({ foldExprs: false, inlineExport: true }));\n}\n\nasync function assembleWatWithWabt(data: string): Promise<ArrayBuffer> {\n  await loadWabt();\n  const module = wabt.parseWat(\"test.wat\", data);\n  module.resolveNames();\n  module.validate();\n  return Promise.resolve(module.toBinary({ log: true, write_debug_names: true }).buffer);\n}\n\ninterface IDominator {\n  children: IDominator [];\n  name: string;\n  retained_size: number;\n  retained_size_percent: number;\n  shallow_size: number;\n  shallow_size_percent: number;\n}\n\nasync function twiggyWasm(data: ArrayBuffer): Promise<string> {\n  await loadTwiggy();\n  let opts;\n  const items = Twiggy.Items.parse(new Uint8Array(data));\n\n  let md = \"# Twiggy Analysis\\n\\nTwiggy is a code size profiler, learn more about it [here](https://github.com/rustwasm/twiggy).\\n\\n\";\n\n  // Top\n  opts = Twiggy.Top.new();\n  const top: Array<{name: string, shallow_size: number, shallow_size_percent: number}> = JSON.parse(items.top(opts));\n\n  md += \"## Top\\n\\n\";\n  md += \"| Shallow Bytes | Shallow % | Item |\\n\";\n  md += \"| ------------: | --------: | :--- |\\n\";\n\n  let ignoreCount = 0;\n  const shallowSizePercentIgnoreThreshold = 0.1;\n  top.forEach(entry => {\n    if (entry.shallow_size_percent >= shallowSizePercentIgnoreThreshold) {\n      md += `| ${entry.shallow_size} | ${entry.shallow_size_percent.toFixed(2)} | \\`${entry.name}\\` |\\n`;\n    } else {\n      ignoreCount ++;\n    }\n  });\n\n  if (ignoreCount) {\n    md += `\\n### Note:\\n${ignoreCount} items had a shallow size percent less than ${shallowSizePercentIgnoreThreshold} and were not listed above.\\n`;\n  }\n\n  // Paths\n  // md += \"\\n\\n# Paths\\n\\n\";\n  // opts = Twiggy.Paths.new();\n  // const paths = JSON.parse(items.paths(opts));\n\n  // Monos\n  // md += \"\\n\\n# Monos\\n\\n\";\n  // opts = Twiggy.Monos.new();\n  // opts.set_max_generics(10);\n  // opts.set_max_monos(10);\n  // const monos = JSON.parse(items.monos(opts));\n\n  md += \"\\n\\n## Dominators\\n\\n\";\n  md += \"| Retained Bytes | Retained % | Dominator Tree |\\n\";\n  md += \"| ------------: | --------: | :--- |\\n\";\n\n  // Dominators\n  const retainedSizePercentIgnoreThreshold = 0.1;\n  ignoreCount = 0;\n  opts = Twiggy.Dominators.new();\n  const dominator: IDominator = JSON.parse(items.dominators(opts));\n  function printDominator(dominator: IDominator, depth: number) {\n    let prefix = \"\";\n    for (let i = 0; i < depth - 1; i++) {\n      prefix += \"   \";\n    }\n    if (depth) {\n      prefix += \"⤷ \";\n    }\n    md += `| ${dominator.retained_size} | ${dominator.retained_size_percent.toFixed(2)} | \\`${prefix + dominator.name}\\` |\\n`;\n    if (dominator.children) {\n      dominator.children.forEach(child => {\n        if (child.retained_size_percent >= retainedSizePercentIgnoreThreshold) {\n          printDominator(child, depth + 1);\n        } else {\n          ignoreCount ++;\n        }\n      });\n    }\n  }\n  printDominator(dominator, 0);\n  if (ignoreCount) {\n    md += `\\n### Note:\\n${ignoreCount} items had a retained size percent less than ${retainedSizePercentIgnoreThreshold} and were not listed above.\\n`;\n  }\n  return Promise.resolve(md);\n}\n"],"sourceRoot":""}